<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LDP TOOLS - Tool V1</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="light-beam"></div>
        <div class="light-beam"></div>
        <div class="light-beam"></div>
    </div>

    <!-- Header -->
    <header class="main-header">
        <div class="menu-icon" id="menuIcon">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <a href="home.html" class="logo">LDP TOOLS</a>
        <div class="user-info">
            <span class="username" id="headerUsername">Username</span>
            <div class="balance-box" id="headerBalance">0ƒë</div>
        </div>
    </header>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <ul>
            <li onclick="window.location.href='home.html'">
                <i>üè†</i> Trang ch·ªß
            </li>
            <li onclick="window.location.href='#account'">
                <i>üë§</i> Ki·ªÉm tra t√†i kho·∫£n
            </li>
            <li onclick="window.location.href='deposit.html'">
                <i>üí∞</i> N·∫°p ti·ªÅn
            </li>
            <li onclick="showHistory()">
                <i>üìú</i> L·ªãch s·ª≠ mua
            </li>
            <li id="adminPanelLink" class="hidden" onclick="window.location.href='admin-panel.html'">
                <i>‚öôÔ∏è</i> Control Panel
            </li>
            <li onclick="logout()">
                <i>üö™</i> ƒêƒÉng xu·∫•t
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Tool Header -->
        <div class="tool-header">
            <h1 class="tool-title">üé≤ Tool V1 - D·ª± ƒëo√°n T√†i X·ªâu</h1>
            <p class="tool-description">C√¥ng c·ª• d·ª± ƒëo√°n T√†i/X·ªâu d·ª±a tr√™n m·∫´u c·∫ßu v√† t·ªâ l·ªá v·ªã t·ª´ 3 x√∫c x·∫Øc</p>
            <div class="tool-status" id="toolStatus">Checking...</div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-title">
                    <span>üé≤</span>
                    <span>Tool V1 Bot</span>
                </div>
                <div class="chat-settings">
                    <button class="settings-btn" onclick="customizeChat()">üé® T√πy ch·ªânh</button>
                    <button class="settings-btn" onclick="resetChat()">üîÑ Reset</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    <div>Xin ch√†o! T√¥i l√† Bot Tool V1 ü§ñ</div>
                    <div class="message-time" id="botTime"></div>
                </div>
                <div class="message bot">
                    <div>G·ª≠i cho t√¥i 3 s·ªë x√∫c x·∫Øc v·ª´a ra (vd: 1 2 3 ho·∫∑c 1,2,3)</div>
                    <div class="message-time"></div>
                </div>
            </div>

            <div class="chat-input-area">
                <input
                    type="text"
                    class="chat-input"
                    id="chatInput"
                    placeholder="Nh·∫≠p 3 s·ªë x√∫c x·∫Øc (vd: 1 2 3)..."
                    maxlength="20"
                >
                <button class="send-btn" onclick="sendDiceInput()">
                    <span>‚û§</span>
                </button>
            </div>
        </div>

        <!-- Usage Instructions -->
        <div class="usage-section">
            <h3>üìñ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h3>
            <div class="usage-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Chu·∫©n b·ªã</h4>
                        <p>ƒê·∫£m b·∫£o tool ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t b·∫±ng key h·ª£p l·ªá</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>G·ª≠i d·ªØ li·ªáu</h4>
                        <p>G·ª≠i 3 s·ªë x√∫c x·∫Øc v·ª´a ra trong game (t·ª´ 1-6)</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Nh·∫≠n k·∫øt qu·∫£</h4>
                        <p>Bot s·∫Ω ph√¢n t√≠ch v√† ƒë∆∞a ra d·ª± ƒëo√°n T√†i/X·ªâu v·ªõi t·ªâ l·ªá ch√≠nh x√°c</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Notification -->
    <div id="notification" class="notification">
        <div class="notification-icon">‚úì</div>
        <div class="notification-content">
            <div class="notification-title">Th√¥ng b√°o</div>
            <div class="notification-message">Message here</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/auth.js"></script>
    <script>
        // Global variables
        let chatHistory = [];
        let isWaitingForInput = true;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé≤ Tool V1 page initializing...');

            // Check authentication
            const currentUser = checkAuth();
            if (!currentUser) return;

            // Check tool access
            if (!checkToolAccess('toolv1')) {
                showNotification('Tool V1 ch∆∞a ƒë∆∞·ª£c k√≠ch ho·∫°t! Vui l√≤ng mua key.', 'error');
                setTimeout(() => {
                    window.location.href = 'home.html';
                }, 3000);
                return;
            }

            // Initialize UI
            initializeHeader();
            initializeSidebar();
            updateToolStatus();

            // Mouse trail effect
            document.addEventListener('mousemove', function(e) {
                const trail = document.createElement('div');
                trail.className = 'mouse-trail';
                trail.style.left = e.pageX - 3 + 'px';
                trail.style.top = e.pageY - 3 + 'px';
                document.body.appendChild(trail);

                setTimeout(() => {
                    trail.remove();
                }, 600);
            });

            // Enter key handler
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendDiceInput();
                }
            });

            console.log('‚úÖ Tool V1 page ready');
        });

        // Update tool status
        function updateToolStatus() {
            const statusEl = document.getElementById('toolStatus');
            const currentUser = getCurrentUser();

            if (checkToolAccess('toolv1')) {
                const tool = currentUser.tools.toolv1;
                if (tool.expiry) {
                    const remaining = getTimeRemaining(tool.expiry);
                    statusEl.className = 'tool-status active';
                    statusEl.textContent = `ƒê√£ k√≠ch ho·∫°t - C√≤n ${remaining}`;
                } else {
                    statusEl.className = 'tool-status active';
                    statusEl.textContent = 'ƒê√£ k√≠ch ho·∫°t';
                }
            } else {
                statusEl.className = 'tool-status locked';
                statusEl.textContent = 'Ch∆∞a k√≠ch ho·∫°t';
            }
        }

        // Send dice input
        function sendDiceInput() {
            const input = document.getElementById('chatInput');
            const diceText = input.value.trim();

            if (!diceText) {
                showNotification('Vui l√≤ng nh·∫≠p 3 s·ªë x√∫c x·∫Øc!', 'warning');
                return;
            }

            // Parse dice input
            const dice = parseDiceInput(diceText);
            if (!dice) {
                showNotification('ƒê·ªãnh d·∫°ng kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p 3 s·ªë t·ª´ 1-6.', 'error');
                addBotMessage('‚ùå ƒê·ªãnh d·∫°ng kh√¥ng h·ª£p l·ªá! Vui l√≤ng g·ª≠i 3 s·ªë x√∫c x·∫Øc t·ª´ 1-6 (vd: 1 2 3)');
                return;
            }

            // Add user message
            addUserMessage(diceText);

            // Process prediction
            const prediction = predictTaiXiu(dice);

            // Add bot response
            addBotMessage(prediction.message);

            // Clear input
            input.value = '';
        }

        // Parse dice input
        function parseDiceInput(text) {
            // Remove commas and split by spaces
            const cleaned = text.replace(/,/g, ' ').replace(/\s+/g, ' ').trim();
            const parts = cleaned.split(' ');

            if (parts.length !== 3) return null;

            const dice = [];
            for (const part of parts) {
                const num = parseInt(part);
                if (isNaN(num) || num < 1 || num > 6) return null;
                dice.push(num);
            }

            return dice;
        }

        // Predict Tai Xiu
        function predictTaiXiu(dice) {
            const [a, b, c] = dice;
            const total = a + b + c;

            // Advanced prediction algorithm
            const prediction = calculatePrediction(a, b, c);

            let message = `üé≤ *K·∫æT QU·∫¢ PH√ÇN T√çCH*\n\n`;
            message += `X√∫c x·∫Øc v·ª´a ra: ${a} ${b} ${c} (T·ªïng: ${total})\n\n`;
            message += `üéØ *D·ª∞ ƒêO√ÅN V√ÅN TI·∫æP THEO:*\n`;
            message += `‚û§ Ch·ªçn: **${prediction.recommendation}**\n\n`;
            message += `üìä *T·ªâ l·ªá th·∫Øng:*\n`;
            message += `‚Ä¢ T√†i: ${prediction.taiPercent}%\n`;
            message += `‚Ä¢ X·ªâu: ${prediction.xiuPercent}%\n\n`;
            message += `üé™ *D·ª∞ ƒêO√ÅN V·ªä:*\n`;
            message += `${prediction.positions.join(' ')}\n\n`;
            message += `üí° *T·ªâ l·ªá ƒë√∫ng:* ${prediction.accuracy}%`;

            return {
                message: message,
                data: prediction
            };
        }

        // Calculate prediction using advanced algorithm
        function calculatePrediction(a, b, c) {
            // Base calculation
            const total = a + b + c;
            const avg = total / 3;

            // Pattern analysis
            const sorted = [a, b, c].sort((x, y) => x - y);
            const hasPair = (a === b || b === c || a === c);
            const hasTriple = (a === b && b === c);
            const highCount = [a, b, c].filter(x => x >= 4).length;
            const lowCount = 3 - highCount;

            // Probability calculation
            let taiProb = 0.5;
            let xiuProb = 0.5;

            // Adjust based on patterns
            if (hasTriple) {
                // Triple usually leads to opposite
                taiProb = total > 10 ? 0.4 : 0.6;
                xiuProb = 1 - taiProb;
            } else if (hasPair) {
                // Pair tends to continue trend
                taiProb = total >= 11 ? 0.55 : 0.45;
                xiuProb = 1 - taiProb;
            } else if (highCount > lowCount) {
                // More high numbers -> likely Tai
                taiProb = 0.6;
                xiuProb = 0.4;
            } else if (lowCount > highCount) {
                // More low numbers -> likely Xiu
                taiProb = 0.4;
                xiuProb = 0.6;
            }

            // Add some randomness but keep it deterministic
            const seed = a * 7 + b * 13 + c * 17;
            const randomFactor = (seed % 20 - 10) / 100; // -0.1 to +0.1
            taiProb += randomFactor;
            xiuProb -= randomFactor;

            // Ensure valid range
            taiProb = Math.max(0.1, Math.min(0.9, taiProb));
            xiuProb = 1 - taiProb;

            // Determine recommendation
            const recommendation = taiProb >= 0.5 ? 'T√ÄI' : 'X·ªàU';

            // Generate position predictions
            const positions = generatePositions(recommendation, total);

            // Calculate accuracy
            const accuracy = Math.round((Math.max(taiProb, xiuProb) + 0.3) * 100);

            return {
                recommendation: recommendation,
                taiPercent: Math.round(taiProb * 100),
                xiuPercent: Math.round(xiuProb * 100),
                positions: positions,
                accuracy: Math.min(95, accuracy)
            };
        }

        // Generate position predictions
        function generatePositions(recommendation, currentTotal) {
            const positions = [];
            const targetRange = recommendation === 'T√ÄI' ? [11, 18] : [3, 10];

            // Generate 3 different positions within target range
            const used = new Set();

            while (positions.length < 3) {
                let pos;
                do {
                    pos = Math.floor(Math.random() * (targetRange[1] - targetRange[0] + 1)) + targetRange[0];
                } while (used.has(pos));

                used.add(pos);
                positions.push(pos);
            }

            return positions.sort((a, b) => a - b);
        }

        // Add user message to chat
        function addUserMessage(text) {
            const messages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div>${text}</div>
                <div class="message-time">${new Date().toLocaleTimeString('vi-VN')}</div>
            `;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        // Add bot message to chat
        function addBotMessage(text) {
            const messages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = `
                <div>${text.replace(/\n/g, '<br>')}</div>
                <div class="message-time">${new Date().toLocaleTimeString('vi-VN')}</div>
            `;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        // Customize chat (placeholder)
        function customizeChat() {
            showNotification('T√≠nh nƒÉng t√πy ch·ªânh ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...');
        }

        // Reset chat
        function resetChat() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën reset cu·ªôc tr√≤ chuy·ªán?')) {
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message bot">
                        <div>Xin ch√†o! T√¥i l√† Bot Tool V1 ü§ñ</div>
                        <div class="message-time">${new Date().toLocaleTimeString('vi-VN')}</div>
                    </div>
                    <div class="message bot">
                        <div>G·ª≠i cho t√¥i 3 s·ªë x√∫c x·∫Øc v·ª´a ra (vd: 1 2 3 ho·∫∑c 1,2,3)</div>
                        <div class="message-time">${new Date().toLocaleTimeString('vi-VN')}</div>
                    </div>
                `;
                chatHistory = [];
            }
        }

        // Show history (placeholder)
        function showHistory() {
            showNotification('T√≠nh nƒÉng l·ªãch s·ª≠ ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...');
        }
    </script>
</body>
</html>
